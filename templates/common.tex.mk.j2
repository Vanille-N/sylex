# Autogenerated by SyLeX

TEXFLAGS = --halt-on-error --interaction=nonstopmode
TEXC = pdflatex $(TEXFLAGS)

compile:
    cd $(DIR) && $(TEXC) $(FILE) | \
        grep -Ev 'texmf-dist|\.code\.tex|\.dict|^[^(]*\)' | \
        sed '/^[[:space:]]*$$/d'

build/%.tex: src/%.tex
    mkdir -p $$(dirname $@)
    cp $< $@
    # Reroot
    ROOT="$$(realpath build)"; \
    HERE="$$(dirname $$(realpath $@))"; \
    echo "ROOT=$${ROOT} HERE=$${HERE}"; \
    sed -Ei \
        -e 's,(\\(input|include|includegraphics).*\{)\$$\(ROOT\),\1'"$${ROOT}"',g;'\
        -e 's,(\\(input|include|includegraphics).*\{)\$$\(HERE\),\1'"$${HERE}"',g;'\
        $@

build/%: src/%
    mkdir -p $$(dirname $@)
    cp $< $@

build/%.pdf: build/%.tex
    make DIR=$$(dirname $@) FILE=$$(basename $<) compile

TARGET = all
loop:
    ./texwatch $(TARGET)

.PHONY: compile loop tar
